{% from "quote-editor.html" import quote_editor %}
{% from "modal.html" import modal %}

{% macro quote_view(quote, is_permalink=False) %}
  <article class="quote">
    <h2>{{ quote.date|format_date }}
      <span class="toolbar">
        <a href="#edit-quote-modal-{{ quote.id }}" data-toggle="modal" title="{{ _('Edit') }}">
          <span class="glyphicon glyphicon-edit"></span></a>
        <a href="#delete-quote-modal-{{ quote.id }}" data-toggle="modal" title="{{ _('Delete') }}">
          <span class="glyphicon glyphicon-trash"></span></a>
        <a href="{{ url_for('quote', quote_id=quote.id) }}" title="{{ _('Permalink') }}">
          <span class="glyphicon glyphicon-link"></span></a>
      </span>
    </h2>
    <p class="quote-text">
      {{ quote.html() }}
    </p>
    {{ quote_editor(modal_id='edit-quote-modal-{}'.format(quote.id),
                    quote_id=quote.id, quote_text=quote.content,
                    next=request.url) }}

    {% call modal(modal_id='delete-quote-modal-{}'.format(quote.id),
                  title=_('Delete Quote')) %}
      <p>{{ _('Are you sure you want to delete this quote?') }}</p>
      <div class="modal-btn-bar">
        <form action="{{ url_for('remove') }}" method="post">
          <input type="hidden" name="quote_id" value="{{ quote.id }}"/>
          <input type="hidden" name="next" value="{{ url_for('homepage') if is_permalink else request.url }}"/>
          <button class="btn btn-danger" type="submit">{{ _('Delete') }}</button>
          <a href="#" class="btn btn-default" data-dismiss="modal">{{ _('Cancel') }}</a>
        </form>
      </div>
      <div class="clearfix"></div>
    {% endcall %}
  </article>
{% endmacro %}
